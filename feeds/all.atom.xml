<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Nejc Saje</title><link href="http://nsaje.si/" rel="alternate"></link><link href="http://nsaje.si/feeds/all.atom.xml" rel="self"></link><id>http://nsaje.si/</id><updated>2014-08-12T21:10:00+02:00</updated><entry><title>Diving into OpenStack development for fun and profit</title><link href="http://nsaje.si/diving-into-openstack.html" rel="alternate"></link><updated>2014-08-12T21:10:00+02:00</updated><author><name>Nejc Saje</name></author><id>tag:nsaje.si,2014-08-12:diving-into-openstack.html</id><summary type="html">&lt;p&gt;When Gregor Pipan from XLAB called me into his office one day last year and told me that he needed someone to work on OpenStack, I had never heard of that name before. But I said yes and here I am a little over a year later: two OpenStack summits behind me, both in Hong Kong and in Atlanta, and currently working on OpenStack for Red Hat!&lt;/p&gt;
&lt;div class="section" id="what-is-openstack"&gt;
&lt;h2&gt;What is OpenStack?&lt;/h2&gt;
&lt;p&gt;OpenStack is a free and open-source software cloud computing platform. In simple terms, you install it on a bunch of computers which then become your private cloud. You can then start, stop and manage virtual machines, virtual networks and many more things via a web or a command line interface provided by OpenStack. It was initially started as a joint project of Rackspace Hosting and NASA, but is now developed by many companies around the world.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="why-work-on-openstack"&gt;
&lt;h2&gt;Why work on OpenStack?&lt;/h2&gt;
&lt;ol class="arabic"&gt;
&lt;li&gt;&lt;p class="first"&gt;&lt;strong&gt;To be part of something big!&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;As Gregor Pipan put it, OpenStack is the Linux of our time. While still very young, it aims to be the ubiquitous cloud computing platform that will meet the needs for all kinds of cloud deployments regardless of size.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;&lt;strong&gt;To work in open-source.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Open-source fosters innovation more than any other kind of software licensing. Since starting out being developed by only two companies, the latest release of OpenStack had contributions from 1235 engineers working for 117 companies. Which brings us to the next reason.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;&lt;strong&gt;To get in touch with lots of talented people.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;When working on a project with such a mass of developers, it is very easy to get to know many extremely talented people who will help you advance both your knowledge and your career.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;&lt;strong&gt;To get a job.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Last but not least: OpenStack is hot stuff at the moment. At the summit in Atlanta, almost every booth had a big sign saying &amp;quot;We're hiring&amp;quot;. If you'd like to work in something else than web development, here's a great chance. It's a very open community, easy to join, and a huge amount of doors will open for you.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div class="section" id="how-to-get-started"&gt;
&lt;h2&gt;How to get started?&lt;/h2&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;If you'd like to get your feet wet first, fire up a VM and install &lt;a class="reference external" href="http://devstack.org"&gt;devstack&lt;/a&gt; on it. Devstack is a bash script that installs a development version of OpenStack completely automatically.&lt;/li&gt;
&lt;li&gt;After that, I'd recommend reading up about OpenStack on &lt;a class="reference external" href="http://en.wikipedia.org/wiki/OpenStack"&gt;Wikipedia&lt;/a&gt;, which gives a great overview of the project.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Read the code!&lt;/strong&gt; Check out the &lt;a class="reference external" href="https://github.com/openstack"&gt;OpenStack repository&lt;/a&gt; on GitHub. After doing #2, you know that OpenStack is comprised of multiple projects. Find out how the one you're most interested in works in detail by reading its code.&lt;/li&gt;
&lt;li&gt;Join &lt;a class="reference external" href="https://wiki.openstack.org/wiki/IRC"&gt;IRC&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Start reviewing.&lt;/strong&gt; Go to &lt;a class="reference external" href="https://review.openstack.org"&gt;https://review.openstack.org&lt;/a&gt; and search for project of your choice (for example 'project:openstack/nova' in the search bar). Reviewing code might look daunting, but in reality it's the best and quickest way to become a part of the community. Pick a few patches that you can get to know better, then follow what other reviewers are saying about them. This way you will learn the style of communication within the community, the typical mistakes and you'll get to know the inner workings of your project better!&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Fix bugs.&lt;/strong&gt; When you're familiar enough with the code, you can start fixing bugs, which will probably be the gateway to actually getting your code into OpenStack. This is the really fun part, but it takes some setting up, check out &lt;a class="reference external" href="https://wiki.openstack.org/wiki/Gerrit_Workflow"&gt;OpenStack Gerrit Workflow&lt;/a&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div class="section" id="communication-in-the-community"&gt;
&lt;h2&gt;Communication in the community&lt;/h2&gt;
&lt;p&gt;In the world of open source, where most of the communication is done over text-only channels like e-mail and IRC, solid communication skills are even more important than elsewhere.&lt;/p&gt;
&lt;p&gt;Be communicative, constructive, friendly, patient and the community will welcome you. Be needy, spammy, arrogant and the community will ignore you.&lt;/p&gt;
&lt;p&gt;A protip for those of you that aren't used to IRC: if you write something in the channel, you probably won't get a response. People don't watch their IRC clients all day, they get a notification when their nick is included in some text. It's therefore best to figure out beforehand &lt;em&gt;who&lt;/em&gt; you want to ask and then ask them directly.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="conclusion"&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Get cracking, good luck and see you at the next summit!&lt;/strong&gt;&lt;/p&gt;
&lt;/div&gt;
</summary><category term="OpenStack"></category><category term="development"></category><category term="Python"></category></entry><entry><title>Dependency-less REST CPU burner in Go</title><link href="http://nsaje.si/dependency-less-rest-cpu-burner-in-go.html" rel="alternate"></link><updated>2014-01-24T08:40:00+01:00</updated><author><name>Nejc Saje</name></author><id>tag:nsaje.si,2014-01-24:dependency-less-rest-cpu-burner-in-go.html</id><summary type="html">&lt;p&gt;Disclaimer: not really REST, but writing HTTP-controlled made the title too long.&lt;/p&gt;
&lt;h2&gt;TL;DR&lt;/h2&gt;
&lt;p&gt;When compiled with &lt;code&gt;CGO_ENABLED=0&lt;/code&gt;, this code produces a static binary file that can be uploaded to a server and run.
CPU burn can be started by requesting &lt;code&gt;/start_cpu&lt;/code&gt; and stopped by requesting &lt;code&gt;/stop_cpu&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;Long version&lt;/h2&gt;
&lt;p&gt;Recently I had to implement an integration test in which I had to fire up a virtual machine and control its CPU load. The first idea was to write a simple Python web service, so I could control the CPU load via HTTP requests. The testing was being done on devstack though, and its test VM image is that of &lt;a href="https://launchpad.net/cirros"&gt;CirrOS&lt;/a&gt;, which only includes Busybox and no Python.&lt;/p&gt;
&lt;p&gt;So I needed a static binary I could just &lt;code&gt;scp&lt;/code&gt; on the VM and run. &lt;a href="http://golang.org"&gt;Go&lt;/a&gt; turned out to be the answer to my problem. Even though I never programmed in Go before, I soon had a working HTTP-controlled staticly linked web service. To achieve static linking, the compiler and the code needs to be compiled with environment variable &lt;code&gt;CGO_ENABLED=0&lt;/code&gt; (&lt;a href="https://groups.google.com/forum/#!topic/golang-nuts/Rw89bnhPBUI"&gt;issue&lt;/a&gt;).&lt;/p&gt;
&lt;h3&gt;Cross compilation&lt;/h3&gt;
&lt;p&gt;On top of that, Go allowed me to easily cross-compile a Linux binary on OSX just by (quickly) recompiling Go compiler with Linux support&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;cd&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;local&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;go&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;src&lt;/span&gt;
&lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;GOOS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;linux&lt;/span&gt; &lt;span class="n"&gt;GOARCH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;386&lt;/span&gt; &lt;span class="n"&gt;CGO_ENABLED&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;make&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bash&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;no&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;clean&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;and then compiling my code with additional options &lt;code&gt;GOOS=linux GOARCH=386&lt;/code&gt;.
Other platforms are similar, for more information take a look at &lt;a href="http://dave.cheney.net/2012/09/08/an-introduction-to-cross-compilation-with-go"&gt;An introduction to cross compilation with Go&lt;/a&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;package main

import &lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;fmt&amp;quot;&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;net/http&amp;quot;&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;time&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;

var burnCpu &lt;span class="o"&gt;=&lt;/span&gt; make&lt;span class="p"&gt;(&lt;/span&gt;chan bool&lt;span class="p"&gt;)&lt;/span&gt;

func cpuBurn&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    var burn bool &lt;span class="o"&gt;=&lt;/span&gt; false
    &lt;span class="kr"&gt;for&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        select &lt;span class="p"&gt;{&lt;/span&gt;
        case burn &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;burnCpu&lt;span class="o"&gt;:&lt;/span&gt;
        default&lt;span class="o"&gt;:&lt;/span&gt;
            &lt;span class="kr"&gt;if&lt;/span&gt; burn &lt;span class="p"&gt;{&lt;/span&gt;
                _ &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;5&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="m"&gt;5&lt;/span&gt;
            &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="kr"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                time.Sleep&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;100&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; time.Millisecond&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

func startCpu&lt;span class="p"&gt;(&lt;/span&gt;w http.ResponseWriter&lt;span class="p"&gt;,&lt;/span&gt; r &lt;span class="o"&gt;*&lt;/span&gt;http.Request&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    fmt.Fprintf&lt;span class="p"&gt;(&lt;/span&gt;w&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Starting CPU burn\n&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    burnCpu &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; true
&lt;span class="p"&gt;}&lt;/span&gt;

func stopCpu&lt;span class="p"&gt;(&lt;/span&gt;w http.ResponseWriter&lt;span class="p"&gt;,&lt;/span&gt; r &lt;span class="o"&gt;*&lt;/span&gt;http.Request&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    fmt.Fprintf&lt;span class="p"&gt;(&lt;/span&gt;w&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Stopping CPU burn\n&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    burnCpu &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; false
&lt;span class="p"&gt;}&lt;/span&gt;

func main&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    go cpuBurn&lt;span class="p"&gt;()&lt;/span&gt;
    http.HandleFunc&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/start_cpu&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; startCpu&lt;span class="p"&gt;)&lt;/span&gt;
    http.HandleFunc&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/stop_cpu&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; stopCpu&lt;span class="p"&gt;)&lt;/span&gt;
    http.ListenAndServe&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;:8080&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; nil&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="golang"></category><category term="openstack"></category><category term="cirros"></category></entry><entry><title>OpenStack development with Vagrant and PyCharm</title><link href="http://nsaje.si/openstack-development-with-vagrant-and-pycharm.html" rel="alternate"></link><updated>2013-11-15T10:20:00+01:00</updated><author><name>Nejc Saje</name></author><id>tag:nsaje.si,2013-11-15:openstack-development-with-vagrant-and-pycharm.html</id><summary type="html">&lt;p&gt;Up until now, my OpenStack development setup looked like this:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;devstack running in a VM,&lt;/li&gt;
&lt;li&gt;developing using tmux &amp;amp; vim over SSH.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Since I was hearing good things about PyCharm, I decided to give it a try. The idea of the setup is as follows:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;devstack running in a VM,&lt;/li&gt;
&lt;li&gt;developing using PyCharm running locally.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;To achieve this, I used the concept of shared/synced folders. Development files are kept on the host machine, where I can use an IDE such as PyCharm for development, but are also be mounted in my devstack VM via NFS. In fact, the entire Devstack's &lt;code&gt;/opt/stack&lt;/code&gt; directory is kept on the host machine. For easy setup, I used &lt;a href="http://www.vagrantup.com"&gt;Vagrant 1.3.5&lt;/a&gt; and &lt;a href="https://www.virtualbox.org"&gt;Virtualbox 4.3.2&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Vagrant and PyCharm" src="images/vagrantpycharm.png" /&gt;&lt;/p&gt;
&lt;p&gt;With the help of blog posts by &lt;a href="http://terriyu.info/blog/posts/2013/07/installing-devstack-ceilometer/"&gt;Terri Yu&lt;/a&gt;, &lt;a href="http://anteaya.info/blog/2013/09/01/installing-devstack-with-vagrant/"&gt;Anita Kuno&lt;/a&gt; and many helpful tips from John Herndon of HP, I came up with this Vagrantfile (&lt;a href="https://gist.github.com/nsaje/14f72ce299f6cc1275ae/download"&gt;download&lt;/a&gt;):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;script&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;SCRIPT&lt;/span&gt;
&lt;span class="cp"&gt;# download required packages&lt;/span&gt;
&lt;span class="n"&gt;apt&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="n"&gt;update&lt;/span&gt;
&lt;span class="n"&gt;apt&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="n"&gt;install&lt;/span&gt; &lt;span class="n"&gt;git&lt;/span&gt; &lt;span class="n"&gt;vim&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;gtk&lt;/span&gt; &lt;span class="n"&gt;libxml2&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dev&lt;/span&gt; &lt;span class="n"&gt;libxslt1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dev&lt;/span&gt; &lt;span class="n"&gt;libpq&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dev&lt;/span&gt; &lt;span class="n"&gt;python&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;pip&lt;/span&gt; &lt;span class="n"&gt;libsqlite3&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dev&lt;/span&gt;
&lt;span class="n"&gt;apt&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="n"&gt;build&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dep&lt;/span&gt; &lt;span class="n"&gt;python&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;mysqldb&lt;/span&gt;
&lt;span class="n"&gt;pip&lt;/span&gt; &lt;span class="n"&gt;install&lt;/span&gt; &lt;span class="n"&gt;git&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;review&lt;/span&gt; &lt;span class="n"&gt;tox&lt;/span&gt;

&lt;span class="cp"&gt;# download devstack&lt;/span&gt;
&lt;span class="n"&gt;git&lt;/span&gt; &lt;span class="n"&gt;clone&lt;/span&gt; &lt;span class="n"&gt;git&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;//git.openstack.org/openstack-dev/devstack&lt;/span&gt;
&lt;span class="n"&gt;chown&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;R&lt;/span&gt; &lt;span class="n"&gt;vagrant&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;vagrant&lt;/span&gt; &lt;span class="n"&gt;devstack&lt;/span&gt;

&lt;span class="cp"&gt;# create minimal localrc&lt;/span&gt;
&lt;span class="n"&gt;cat&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;_LOCALRC&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;devstack&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;localrc&lt;/span&gt;
&lt;span class="n"&gt;ADMIN_PASSWORD&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;
&lt;span class="n"&gt;MYSQL_PASSWORD&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;
&lt;span class="n"&gt;RABBIT_PASSWORD&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;
&lt;span class="n"&gt;SERVICE_PASSWORD&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;
&lt;span class="n"&gt;SERVICE_TOKEN&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;tokentoken&lt;/span&gt;

&lt;span class="n"&gt;LOGFILE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;stack&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;log&lt;/span&gt;
&lt;span class="n"&gt;LOGDAYS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;

&lt;span class="cp"&gt;# data must not be inside NFS share&lt;/span&gt;
&lt;span class="cp"&gt;# because devstack tries to chown directories&lt;/span&gt;
&lt;span class="cp"&gt;# and NFS doesn&amp;#39;t allow it&lt;/span&gt;
&lt;span class="n"&gt;DATA_DIR&lt;/span&gt;&lt;span class="o"&gt;=/&lt;/span&gt;&lt;span class="n"&gt;opt&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;
&lt;span class="n"&gt;_LOCALRC&lt;/span&gt;
&lt;span class="n"&gt;SCRIPT&lt;/span&gt;

&lt;span class="cp"&gt;## Vagrant config&lt;/span&gt;
&lt;span class="n"&gt;VAGRANTFILE_API_VERSION&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;2&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;Vagrant&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;configure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;VAGRANTFILE_API_VERSION&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;box&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;precise64&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;box_url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;http://files.vagrantup.com/precise64.box&amp;quot;&lt;/span&gt;

  &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;Change&lt;/span&gt; &lt;span class="n"&gt;memory&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="n"&gt;our&lt;/span&gt; &lt;span class="n"&gt;VM&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="mi"&gt;2048&lt;/span&gt;&lt;span class="n"&gt;MB&lt;/span&gt;
  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;provider&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;virtualbox&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;vb&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
    &lt;span class="n"&gt;vb&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;customize&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;modifyvm&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;--memory&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;2048&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
  &lt;span class="n"&gt;end&lt;/span&gt;

  &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;Forward&lt;/span&gt; &lt;span class="n"&gt;port&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;Horizon&lt;/span&gt;
  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;network&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;forwarded_port&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;guest&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;80&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;8080&lt;/span&gt;

  &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;Private&lt;/span&gt; &lt;span class="n"&gt;network&lt;/span&gt; &lt;span class="n"&gt;IP&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;needed&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;NFS&lt;/span&gt;
  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;network&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;private_network&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ip&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;192.168.33.10&amp;quot;&lt;/span&gt;

  &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;opt&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;stack&lt;/span&gt; &lt;span class="n"&gt;is&lt;/span&gt; &lt;span class="n"&gt;synced&lt;/span&gt; &lt;span class="n"&gt;with&lt;/span&gt; &lt;span class="n"&gt;vagrant&lt;/span&gt; &lt;span class="n"&gt;project&lt;/span&gt; &lt;span class="n"&gt;dir&lt;/span&gt; &lt;span class="n"&gt;over&lt;/span&gt; &lt;span class="n"&gt;NFS&lt;/span&gt;
  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;synced_folder&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/opt/stack&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;nfs&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;

  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;provision&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;shell&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kr"&gt;inline&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;script&lt;/span&gt;
&lt;span class="n"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;All you need to do to get a Devstack development environment with its &lt;code&gt;/opt/stack&lt;/code&gt; kept on the host machine is copy this Vagrantfile into your directory of choice and run&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;vagrant&lt;/span&gt; &lt;span class="n"&gt;up&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Setting up PyCharm&lt;/h2&gt;
&lt;p&gt;This part is really easy, just follow the instructions at &lt;a href=""&gt;https://www.jetbrains.com/pycharm/webhelp/remote-debugging.html#5&lt;/a&gt;. Basically you just click a button that fills in your Vagrant config and voilà, you can run and debug projects on your devstack VM.&lt;/p&gt;
&lt;h2&gt;Lessons learned&lt;/h2&gt;
&lt;p&gt;I was warned about these by John Herndon, but I had to try them out myself to see why:&lt;/p&gt;
&lt;h4&gt;1. Devstack's DATA_DIR variable mustn't reside on the NFS share&lt;/h4&gt;
&lt;p&gt;Nova creates stuff in the data directory with root permissions and then tries to &lt;code&gt;chown&lt;/code&gt; them, which fails on the NFS share.&lt;/p&gt;
&lt;h4&gt;2. NFS share must reside on a case-sensitive filesystem&lt;/h4&gt;
&lt;p&gt;Unit tests for some projects require python packages that have the same name, save for the case. In my case, the problematic packages were &lt;code&gt;Crypto&lt;/code&gt; and &lt;code&gt;crypto&lt;/code&gt;.&lt;/p&gt;</summary><category term="python"></category><category term="openstack"></category><category term="devstack"></category><category term="vagrant"></category><category term="pycharm"></category><category term="remote"></category><category term="development"></category></entry></feed>